<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>í”„ë¦¬ë„¤ê°€ì¡±íŒ€ ë‚¨ê²½ ì—¬í–‰ - ì˜¨ë¼ì¸ ìˆ™ì§€í˜„í™©</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
  body{font-family:'Inter','Noto Sans KR',sans-serif;background:#f7fafc;}
  .accordion-header{cursor:pointer;}
  .accordion-header .icon{transition:transform .3s ease;}
  .accordion-header.active .icon{transform:rotate(180deg);}
  input[type=checkbox]:checked+label{text-decoration:line-through;color:#a0aec0;}
  .confirmation-table th,.confirmation-table td{text-align:center;padding:.75rem .5rem;border:1px solid #e2e8f0;font-size:.875rem}
  .confirmation-table th{background:#f8fafc;font-weight:600}
  .confirmation-table .member-name{text-align:left;font-weight:600;white-space:nowrap}
  .info-section{padding:1rem;background:#f8fafc;border-radius:8px;margin-bottom:1rem}
  .info-title{font-weight:600;color:#1e3a8a;margin-bottom:.5rem}
  .highlight-box{background:#fffbeb;border-left:4px solid #f59e0b;padding:1rem;margin-top:1rem;border-radius:4px}
  .comparison-table th,.comparison-table td{border:1px solid #e2e8f0;padding:.75rem;text-align:center;font-size:.875rem}
  .comparison-table th{background:#f1f5f9;font-weight:600}
  .hidden-important{display:none !important;} /* used in Day-0 mode */
</style>
</head>
<body class="bg-gray-50 text-gray-800">

<!-- ğŸ”¥ Firebase ì„¤ì •ê°’ì„ ì´ê³³ì— ë„£ìœ¼ì„¸ìš” (ë°°í¬ ì „ í•„ìˆ˜) -->
<script>
  /* === FILL THESE BEFORE DEPLOY === */
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyA27iXhZPvc0w6lzaw9mGpbe2pbIWliQtc",
  authDomain: "freene-nanjing-2025.firebaseapp.com",
  projectId: "freene-nanjing-2025",
  storageBucket: "freene-nanjing-2025.firebasestorage.app",
  messagingSenderId: "106888422558",
  appId: "1:106888422558:web:429a64702973b71ecf878f",
  measurementId: "G-1NJ9PW5TF8"
};

  const __app_id = "freene-nanjing-2025";  // ììœ ë¡­ê²Œ
  const __initial_auth_token = "";         // ìµëª… ë¡œê·¸ì¸ ì“¸ ê±°ë©´ ë¹„ì›Œë‘ 
</script>

<div id="app-root" class="container mx-auto max-w-4xl p-4 sm:p-8">
  <header class="text-center mb-8">
    <h1 class="text-3xl sm:text-4xl font-bold text-blue-600">í”„ë¦¬ë„¤ê°€ì¡±íŒ€ ë‚¨ê²½ ì—¬í–‰</h1>
    <p class="text-lg text-gray-600 mt-1">ìµœì¢… ì ê²€ & ì˜¨ë¼ì¸ ìˆ™ì§€í˜„í™©</p>
    <p id="dday-widget" class="text-lg font-semibold text-red-600 mt-2"></p>
  </header>

  <!-- ì˜¨ë¼ì¸ ìˆ™ì§€ í˜„í™© í…Œì´ë¸” -->
  <div id="online-status-card" class="bg-white rounded-lg shadow-md border border-gray-200 p-5 mb-8">
    <h2 class="text-xl font-semibold text-blue-700 mb-4 text-center">
      <i class="fas fa-user-check mr-2"></i>íŒ€ì›ë³„ ìˆ™ì§€ í˜„í™©
    </h2>
    <p class="text-center text-gray-600 mb-4">
      ì•„ë˜ í‘œëŠ” Firestoreë¥¼ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë™ê¸°í™”ë©ë‹ˆë‹¤. (ì¤€ë¹„ë¬¼ ê°œë³„í•­ëª©ì€ ê³µìœ ë˜ì§€ ì•ŠìŒ)
    </p>
    <div id="confirmation-container" class="overflow-x-auto">
      <p class="text-center text-gray-500">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</p>
    </div>
  </div>

  <!-- ì´ë¦„ ì„ íƒ í™”ë©´ -->
  <div id="login-screen" class="mb-8">
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-5 text-center">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4">ë³¸ì¸ì˜ ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”.</h2>
      <div id="name-selector" class="grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
    </div>
  </div>

  <!-- ë©”ì¸ í™”ë©´ (ì´ë¦„ ì„ íƒ í›„ í‘œì‹œ) -->
  <div id="main-screen" class="space-y-4 hidden">
    <header class="flex flex-col sm:flex-row items-center justify-between gap-4 mb-4">
      <div class="text-center sm:text-left">
        <h2 class="text-2xl font-bold text-blue-600"><span id="user-name"></span>ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
        <p class="text-md text-gray-600 mt-1">ì•„ë˜ í•­ëª©ë“¤ì„ ì½ê³  í™•ì¸ í›„ ì²´í¬í•˜ì„¸ìš”.</p>
      </div>
      <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
        <button id="logout-button" class="w-full sm:w-auto bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg transition">
          <i class="fas fa-arrow-left mr-2"></i>ì´ë¦„ ë‹¤ì‹œ ì„ íƒ
        </button>
        <button id="reset-data-button" class="w-full sm:w-auto bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition">
          ë°ì´í„° ì´ˆê¸°í™”
        </button>
      </div>
    </header>

    <!-- ì˜¨ë¼ì¸ ê³µìœ  í† ê¸€ -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-4 flex items-center justify-between">
      <label for="online-share-toggle" class="text-sm sm:text-base font-medium text-gray-700 flex-1 text-left">
        ì´ ê¸°ê¸°ì˜ ì²´í¬ ê²°ê³¼ë¥¼ ì˜¨ë¼ì¸ í‘œì— ê³µìœ .
      </label>
      <input id="online-share-toggle" type="checkbox" class="h-5 w-5 text-blue-600 rounded border-gray-300 cursor-pointer">
    </div>

    <!-- ì„¹ì…˜ ì»¨í…Œì´ë„ˆ -->
    <div class="space-y-4" id="main-content-sections">
      <!-- JSê°€ ì±„ì›€ -->
    </div>
  </div>
</div>

<!-- Firebase SDK (ëª¨ë“ˆ) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, doc, onSnapshot, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  /* ===========================================================
     === ê¸°ë³¸ êµ¬ì„± =============================================
     =========================================================== */
  const APP_VERSION = "v4-online";
  const STORAGE_KEY = `tripPrepData-Nanjing2025-${APP_VERSION}`;

  const teamMembers = ["ê°•ë¬¸ìˆœ","ê¹€ì¤€í˜•","ê¹€í˜„ì •","ì•ˆìƒí˜„","ê¹€í˜„ì£¼","ë°•ì˜ìˆœ"];
  const sections = {
    plan: "ì§‘ê²°ê³„íš",
    info: "ì£¼ìš”ì•ˆë‚´",
    checklist: "ì¤€ë¹„ë¬¼",
    schedule: "ì¼ì •í‘œ"
  };

  // ì¤€ë¹„ë¬¼ í•­ëª© (ë¡œì»¬ ì „ìš©)
  const checklistItems = {
    docs: [
      { id: 'c1',  text: 'ì—¬ê¶Œ (ì‚¬ë³¸ ë³„ë„ ë³´ê´€)' },
      { id: 'c2',  text: 'í•­ê³µê¶Œ E-ticket' },
      { id: 'c3',  text: 'í•´ì™¸ì‚¬ìš© ê°€ëŠ¥ ì‹ ìš©ì¹´ë“œ' },
      { id: 'c4',  text: 'ìœ„ì•ˆí™” í˜„ê¸ˆ (ì†Œì•¡ê¶Œ)' }
    ],
    clothing: [
      { id: 'c5',  text: 'ì—¬ë¦„ì˜·, í¸í•œ ì‹ ë°œ, ì†ì˜·' },
      { id: 'c6',  text: 'ëƒ‰ë°© ëŒ€ë¹„ìš© ê²‰ì˜·' },
      { id: 'c7',  text: 'ëª¨ì, ì„ ê¸€ë¼ìŠ¤, ìì™¸ì„  ì°¨ë‹¨ì œ' },
      { id: 'c8',  text: 'ì ‘ëŠ” ìš°ì‚°/ì–‘ì‚° (ì„ íƒ)' }
    ],
    electronics: [
      { id: 'c9',  text: 'ìŠ¤ë§ˆíŠ¸í°, ë³´ì¡°ë°°í„°ë¦¬' },
      { id: 'c10', text: 'ì¤‘êµ­ìš© ì „ì› ì–´ëŒ‘í„°' },
      { id: 'c11', text: 'ì¶©ì „ ì¼€ì´ë¸”, ë©€í‹°íƒ­ (ì„ íƒ)' }
    ],
    medicine: [
      { id: 'c12', text: 'ê°œì¸ ë³µìš©ì•½ (í•„ìˆ˜)' },
      { id: 'c13', text: 'ì¢…í•©ê°ê¸°ì•½, ì†Œí™”ì œ, ë°´ë“œ ë“±' },
      { id: 'c14', text: 'ë¹„ìƒ ê°„ì‹ (ì„ íƒ)' }
    ]
  };
  const TOTAL_CHECK_ITEMS = Object.values(checklistItems).flat().length; // 14

  /* ì˜¨ë¼ì¸ ê³µìœ  ì‹œ ì¤€ë¹„ë¬¼ ê°œìˆ˜ ìš”ì•½ì„ í‘œì‹œí• ì§€ ì—¬ë¶€ (true/false) */
  const SHARE_CHECK_COUNTS = true;

  /* ì „ì—­ ìƒíƒœ */
  let currentUser = null;
  let confirmationData = {};    // ë¡œì»¬ ì €ì¥ ë°ì´í„°
  let onlineData = {};          // Firestore ë°ì´í„°(ëª¨ë‘ ë³´ê¸°)
  let shareEnabled = false;     // ë‚´ ê¸°ê¸° ì˜¨ë¼ì¸ ê³µìœ  í† ê¸€

  /* DOM refs */
  const loginScreen = document.getElementById('login-screen');
  const nameSelector = document.getElementById('name-selector');
  const mainScreen  = document.getElementById('main-screen');
  const userNameSpan = document.getElementById('user-name');
  const mainContentContainer = document.getElementById('main-content-sections');
  const confirmationContainer = document.getElementById('confirmation-container');
  const logoutButton = document.getElementById('logout-button');
  const resetButton = document.getElementById('reset-data-button');
  const onlineShareToggle = document.getElementById('online-share-toggle');

  /* ===========================================================
     === ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ =========================================
     =========================================================== */
  function initLocalData(){
    confirmationData = {};
    teamMembers.forEach(m=>{
      confirmationData[m] = {};
      Object.keys(sections).forEach(k=>confirmationData[m][k]=false);
      confirmationData[m].checklist = {};
      for (const cat in checklistItems){
        checklistItems[cat].forEach(item=>{
          confirmationData[m].checklist[item.id] = false;
        });
      }
    });
    saveLocalData();
  }
  function loadLocalData(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw){ initLocalData(); return; }
      confirmationData = JSON.parse(raw);
    }catch(e){
      console.error('local parse fail',e);
      initLocalData();
    }
  }
  function saveLocalData(){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(confirmationData));
    }catch(e){
      console.error('local save fail',e);
    }
  }
  function resetLocal(){
    if(!confirm('ëª¨ë“  ë¡œì»¬ ì²´í¬ ìƒíƒœë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
    localStorage.removeItem(STORAGE_KEY);
    initLocalData();
    if(currentUser) renderMainContent(currentUser);
  }

  /* ===========================================================
     === ì˜¨ë¼ì¸(Firestore) =====================================
     =========================================================== */
  const firebaseConfig = (()=>{
    try { return JSON.parse(__firebase_config); }
    catch(e){ return {apiKey:'DEMO',authDomain:'DEMO',projectId:'DEMO'}; }
  })();
  const appId = (typeof __app_id !== 'undefined' ? __app_id : 'trip-prep-default');

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ë¬¸ì„œ ê²½ë¡œ: artifacts/{appId}/public/trip/status
  const docRef = doc(db, "artifacts", appId, "public", "trip", "status");

  async function firebaseInitAuth(){
    try{
      if(typeof __initial_auth_token !== 'undefined' && __initial_auth_token){
        await signInWithCustomToken(auth, __initial_auth_token);
      }else{
        await signInAnonymously(auth);
      }
    }catch(e){
      console.error('Firebase auth error',e);
    }
  }

  // ì˜¨ë¼ì¸ ë°ì´í„° ì‹¤ì‹œê°„ êµ¬ë…
  function subscribeOnlineData(){
    onSnapshot(docRef,(snap)=>{
      if(snap.exists()){
        onlineData = snap.data();
      }else{
        // ìµœì´ˆ ìƒì„±
        const base = {};
        teamMembers.forEach(m=>{
          base[m] = {};
          Object.keys(sections).forEach(k=>base[m][k]=false);
          if(SHARE_CHECK_COUNTS){
            base[m].checkCount = 0;
            base[m].checkTotal = TOTAL_CHECK_ITEMS;
          }
        });
        setDoc(docRef, base).catch(e=>console.error('init doc fail',e));
        onlineData = base;
      }
      renderOnlineTable(onlineData);
    },(err)=>{
      console.error('snapshot error',err);
      confirmationContainer.innerHTML = '<p class="text-red-500 text-center">ì˜¨ë¼ì¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
    });
  }

  // ì˜¨ë¼ì¸ ì—…ë°ì´íŠ¸(ë‚´ í•­ëª©ë§Œ)
  async function updateOnline(member,section,value){
    if(!shareEnabled) return; // ê³µìœ  ëˆ ìƒíƒœë©´ ì—…ë°ì´íŠ¸ ì•ˆ í•¨
    const updateObj = {};
    updateObj[`${member}.${section}`] = value;
    if(section==='checklist' && SHARE_CHECK_COUNTS){
      const counts = countChecklist(member);
      updateObj[`${member}.checkCount`] = counts.checked;
      updateObj[`${member}.checkTotal`] = counts.total;
    }
    updateObj["_meta"] = { updated: Date.now() };
    try{
      await updateDoc(docRef, updateObj);
    }catch(e){
      console.warn('updateDoc failed; trying setDoc merge',e);
      await setDoc(docRef, updateObj, { merge:true });
    }
  }

  /* ì¤€ë¹„ë¬¼ ê°œìˆ˜ ì§‘ê³„ */
  function countChecklist(member){
    const userData = confirmationData[member] || {};
    const cl = userData.checklist || {};
    let c = 0;
    for (const cat in checklistItems){
      checklistItems[cat].forEach(item=>{
        if(cl[item.id]) c++;
      });
    }
    return {checked:c,total:TOTAL_CHECK_ITEMS};
  }

  /* ===========================================================
     === ì˜¨ë¼ì¸ í…Œì´ë¸” ë Œë” =====================================
     =========================================================== */
  function renderOnlineTable(data){
    if(!confirmationContainer) return;
    const secKeys = Object.keys(sections);
    const secNames = Object.values(sections);
    let html = '<table class="w-full confirmation-table"><thead><tr><th class="member-name">íŒ€ì›</th>';
    secNames.forEach(n=>{ html += `<th>${n}</th>`; });
    if(SHARE_CHECK_COUNTS) html += `<th>ì¤€ë¹„ë¬¼(ê°œìˆ˜)</th>`;
    html += '</tr></thead><tbody>';

    teamMembers.forEach(m=>{
      const row = data[m]||{};
      html += `<tr><td class="member-name">${m}</td>`;
      secKeys.forEach(k=>{
        const checked = row[k] ? 'âœ”ï¸' : '';
        html += `<td>${checked}</td>`;
      });
      if(SHARE_CHECK_COUNTS){
        const cc = typeof row.checkCount==='number'?row.checkCount:0;
        const tt = typeof row.checkTotal==='number'?row.checkTotal:TOTAL_CHECK_ITEMS;
        html += `<td>${cc}/${tt}</td>`;
      }
      html += '</tr>';
    });

    html += '</tbody></table>';
    confirmationContainer.innerHTML = html;
  }

  /* ===========================================================
     === UI ë Œë”: ë¡œê·¸ì¸ =======================================
     =========================================================== */
  function renderLoginScreen(){
    nameSelector.innerHTML = '';
    teamMembers.forEach(name=>{
      const btn = document.createElement('button');
      btn.type='button';
      btn.className="p-4 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600 transition transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500";
      btn.textContent = name;
      btn.dataset.name = name;
      nameSelector.appendChild(btn);
    });
  }

  /* ===========================================================
     === UI ë Œë”: ë©”ì¸ =========================================
     =========================================================== */
  function renderMainContent(user){
    userNameSpan.textContent = user;
    mainContentContainer.innerHTML = `
      <div id="section-plan" class="accordion-item bg-white rounded-lg shadow-md border border-gray-200"></div>
      <div id="section-info" class="accordion-item bg-white rounded-lg shadow-md border border-gray-200"></div>
      <div id="section-checklist" class="accordion-item bg-white rounded-lg shadow-md border border-gray-200"></div>
      <div id="section-schedule" class="accordion-item bg-white rounded-lg shadow-md border border-gray-200"></div>
    `;
    populateContent();          // build markup
    applyUserState(user);       // set checkboxes from local
    setupAccordion();           // open/close behavior
    applyDay0Mode();            // hide non-essential on Day-0 if needed
  }

  /* -----------------------------------------------------------
     ì„¹ì…˜ ë‚´ìš© êµ¬ì„± (í…ìŠ¤íŠ¸ í†µí•©)
     ----------------------------------------------------------- */
  function populateContent(){
    // Section: Plan
    document.getElementById('section-plan').innerHTML = `
      <div class="accordion-header flex justify-between items-center p-5">
        <h2 class="text-xl font-semibold text-blue-700">
          <i class="fas fa-plane-departure mr-3"></i>ì²«ë‚  ì§‘ê²° ë° ì¶œêµ­ ê³„íš (ê°€ì¥ ì¤‘ìš”!)
        </h2>
        <div class="flex items-center space-x-2">
          <label for="check-plan" class="text-sm font-medium text-gray-600">í™•ì¸ì™„ë£Œ</label>
          <input type="checkbox" id="check-plan" data-section="plan" class="h-5 w-5 rounded border-gray-300 text-blue-600">
        </div>
        <i class="fas fa-chevron-down icon ml-4"></i>
      </div>
      <div class="accordion-content p-5 border-t border-gray-200">
        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead class="bg-blue-50">
              <tr>
                <th class="p-3 font-semibold text-sm">ì‹œê°„</th>
                <th class="p-3 font-semibold text-sm">ê³„íš</th>
                <th class="p-3 font-semibold text-sm">ì¥ì†Œ</th>
                <th class="p-3 font-semibold text-sm">ë‹´ë‹¹ ë° ë¹„ê³ </th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b"><td class="p-3">09:20</td><td class="p-3">ì „ì› ì§‘ê²° ë° ì¸ì› ì ê²€</td><td class="p-3">ì¸ì²œê³µí•­ ì œ1ì—¬ê°í„°ë¯¸ë„ 3ì¸µ Fì—´ ì•„ì‹œì•„ë‚˜í•­ê³µ ì¹´ìš´í„° ì•</td><td class="p-3">ê¹€í˜„ì • (ë¦¬ë”)</td></tr>
              <tr class="border-b"><td class="p-3">09:30</td><td class="p-3">ë‹¨ì²´ ìˆ˜ì† ë° ìˆ˜í•˜ë¬¼ ìœ„íƒ</td><td class="p-3">ì•„ì‹œì•„ë‚˜í•­ê³µ ì¹´ìš´í„°</td><td class="p-3">ì „ì› (ì—¬ê¶Œ í•„ìˆ˜ ì§€ì°¸)</td></tr>
              <tr class="border-b"><td class="p-3">10:30</td><td class="p-3">ë³´ì•ˆ ê²€ìƒ‰ ë° ì¶œêµ­ ì‹¬ì‚¬</td><td class="p-3">3ì¸µ ì¶œêµ­ì¥</td><td class="p-3">ê°œë³„ ì§„í–‰</td></tr>
              <tr class="border-b"><td class="p-3">11:00</td><td class="p-3">ë©´ì„¸êµ¬ì—­ ë‚´ ììœ ì‹œê°„ ë° ì•„ì¹¨/ì ì‹¬</td><td class="p-3">ë©´ì„¸êµ¬ì—­</td><td class="p-3">ê°œë³„ ë˜ëŠ” ê·¸ë£¹ í™œë™</td></tr>
              <tr class="border-b"><td class="p-3">11:50</td><td class="p-3">íƒ‘ìŠ¹êµ¬ ì• ì§‘ê²°</td><td class="p-3">íƒ‘ìŠ¹êµ¬ (E-ticket í™•ì¸)</td><td class="p-3 text-red-500 font-bold">ì‹œê°„ ì—„ìˆ˜</td></tr>
              <tr><td class="p-3">12:20</td><td class="p-3">ë‚¨ê²½ìœ¼ë¡œ ì¶œë°œ (OZ349)</td><td class="p-3">-</td><td class="p-3">-</td></tr>
            </tbody>
          </table>
        </div>
      </div>`;

    // Section: Info
    document.getElementById('section-info').innerHTML = `
      <div class="accordion-header flex justify-between items-center p-5">
        <h2 class="text-xl font-semibold text-blue-700">
          <i class="fas fa-info-circle mr-3"></i>ì—¬í–‰ ì¤‘ ì£¼ìš” ì•ˆë‚´ì‚¬í•­
        </h2>
        <div class="flex items-center space-x-2">
          <label for="check-info" class="text-sm font-medium text-gray-600">í™•ì¸ì™„ë£Œ</label>
          <input type="checkbox" id="check-info" data-section="info" class="h-5 w-5 rounded border-gray-300 text-blue-600">
        </div>
        <i class="fas fa-chevron-down icon ml-4"></i>
      </div>
      <div class="accordion-content p-5 border-t border-gray-200 space-y-4">
        <div class="info-section">
          <h4 class="info-title"><i class="fas fa-walking mr-2"></i>ê±´ê°• ë° ì²´ë ¥ ê´€ë¦¬</h4>
          <p>2ì¼ì°¨, 3ì¼ì°¨ëŠ” ë„ë³´ ì´ë™ì´ ë§ê³  7ì›” ë§ ë‚¨ê²½ ë‚ ì”¨ëŠ” ë§¤ìš° ë”ìš¸ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë‹ˆ, í¸í•œ ì‹ ë°œê³¼ ê°€ë²¼ìš´ ì˜·ì°¨ë¦¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤. ì–´ë¥´ì‹ ë“¤ì˜ ì»¨ë””ì…˜ì„ ê³ ë ¤í•˜ì—¬ ê°€ì´ë“œì—ê²Œ ë™ì„  ì¡°ì •ì„ ìš”ì²­í–ˆìœ¼ë©°, í•˜ë£¨ 1~2íšŒ ì¹´í˜ íœ´ì‹ ì‹œê°„ì„ ê°€ì§ˆ ì˜ˆì •ì…ë‹ˆë‹¤.</p>
        </div>
        <div class="info-section">
          <h4 class="info-title"><i class="fas fa-utensils mr-2"></i>ì‹ì‚¬ ë° ë¹„ìƒ ì‹ëŸ‰</h4>
          <p>ì—¬í–‰ ì¤‘ 1íšŒ í•œì‹ë‹¹ì„ ì´ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤. ê·¸ ì™¸ í˜„ì§€ ìŒì‹ì´ ì…ë§›ì— ë§ì§€ ì•Šì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬, ë¹„ìƒ ì‹ëŸ‰(ê¹€, ê¹€ì¹˜, ì»µë¼ë©´, í–‡ë°˜ ë“±)ì„ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤. (ë‹´ë‹¹: ê¹€í˜„ì •)</p>
        </div>
        <div class="info-section">
          <h4 class="info-title"><i class="fas fa-wifi mr-2"></i>ì¸í„°ë„· ì‚¬ìš©: ìµœì ì˜ ì¡°í•© ì•ˆë‚´</h4>
          <p class="mb-4">ì¤‘êµ­ì—ì„œëŠ” ì¸í„°ë„· ì‚¬ìš© ë°©ì‹ì— ë”°ë¼ ì¹´í†¡/Gmail ì‚¬ìš© ì—¬ë¶€, ìš”ê¸ˆ ë“±ì´ í¬ê²Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ìš°ë¦¬ íŒ€ì€ ì•„ë˜ì™€ ê°™ì´ ì—­í• ì„ ë‚˜ëˆ„ì–´ ë¹„ìš©ê³¼ í¸ì˜ì„±ì„ ëª¨ë‘ ì¡ëŠ” ë°©ì‹ìœ¼ë¡œ ì¤€ë¹„í•©ë‹ˆë‹¤.</p>
          <table class="w-full comparison-table mb-4">
            <thead><tr><th>êµ¬ë¶„</th><th>êµ­ì œ ë¡œë°</th><th>ì¤‘êµ­ í˜„ì§€ ìœ ì‹¬ (eSIM)</th></tr></thead>
            <tbody>
              <tr><td class="font-semibold">ì¹´í†¡/Gmail</td><td class="text-green-600 font-bold">ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥ (VPN ë¶ˆí•„ìš”)</td><td class="text-red-600 font-bold">ì‚¬ìš© ë¶ˆê°€ (VPN í•„ìš”)</td></tr>
              <tr><td class="font-semibold">ìš”ê¸ˆ</td><td>ë¹„êµì  ë†’ìŒ</td><td>ë§¤ìš° ì €ë ´</td></tr>
              <tr><td class="font-semibold">ì¥ì </td><td>í•œêµ­ ë²ˆí˜¸ ìœ ì§€, ì¸ì¦ í¸ë¦¬</td><td>ì €ë ´í•˜ê³  ë¹ ë¥¸ í˜„ì§€ ë°ì´í„°</td></tr>
            </tbody>
          </table>
          <div class="highlight-box">
            <p class="font-bold text-lg">ìš°ë¦¬ íŒ€ì˜ ì¤€ë¹„ ê³„íš</p>
            <ul class="list-disc list-inside mt-2">
              <li><strong>ì¤‘ìš” ì—°ë½ ë‹´ë‹¹ (ê¹€í˜„ì •)</strong>: <span class="font-bold text-blue-600">êµ­ì œ ë¡œë°</span> ì‚¬ìš©.</li>
              <li><strong>ë‚˜ë¨¸ì§€ íŒ€ì› (5ëª…)</strong>: <span class="font-bold text-blue-600">ì¤‘êµ­ í˜„ì§€ ìœ ì‹¬(eSIM)</span> ì‚¬ìš© ê¶Œì¥. ì¤€ë¹„ëŠ” <span class=\"font-bold\">ì•ˆìƒí˜„ë‹˜</span>ê»˜ ë¬¸ì˜.</li>
            </ul>
          </div>
        </div>
        <div class="info-section">
          <h4 class="info-title"><i class="fas fa-money-bill-wave mr-2"></i>ê°œì¸ ê²½ë¹„ ë° ì¤‘êµ­ í˜„ì§€ ê²°ì œ ë°©ë²•</h4>
          <p class="mb-2">ì—¬í–‰ê²½ë¹„ ëŒ€ë¶€ë¶„ì€ ì´ë¯¸ ì§€ë¶ˆë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì§€ì—ì„œ í•„ìš”í•œ ê°œì¸ ê²½ë¹„ëŠ” <strong>ê°œì¸ ì‡¼í•‘, ê°„ì‹, ì„ íƒì  ê°€ì´ë“œ/ê¸°ì‚¬ë‹˜ íŒ</strong> ì •ë„ì…ë‹ˆë‹¤.</p>
          <p class="mb-4">ì¤‘êµ­ì€ QR ê²°ì œê°€ í¸ë¦¬í•©ë‹ˆë‹¤. ë„¤ì´ë²„í˜ì´(ì¶©ì „) + ì•Œë¦¬í˜ì´(ì‹ ìš©ì¹´ë“œ ì—°ë™) ì¡°í•©ì„ ì¶”ì²œí•©ë‹ˆë‹¤.</p>
          <div class="p-4 border rounded-md mb-3">
            <h5 class="font-semibold text-lg text-green-600">ë°©ë²• 1. ë„¤ì´ë²„í˜ì´ (í˜„ê¸ˆ ì¶©ì „)</h5>
            <p class="text-sm text-gray-600 mt-1">ê°€ê²Œ QR ì´¬ì˜ í›„ ë°”ë¡œ ê²°ì œ. ë¯¸ë¦¬ ë¨¸ë‹ˆ ì¶©ì „.</p>
          </div>
          <div class="p-4 border rounded-md">
            <h5 class="font-semibold text-lg text-blue-600">ë°©ë²• 2. ì•Œë¦¬í˜ì´ (í•´ì™¸ê²°ì œ ì¹´ë“œ)</h5>
            <p class="text-sm text-gray-600 mt-1">í•´ì™¸ì‚¬ìš© ê°€ëŠ¥ ì‹ ìš©ì¹´ë“œ ë“±ë¡. ë„¤ì´ë²„í˜ì´ ì•ˆ ë˜ëŠ” ê³³ì—ì„œ ìœ ìš©.</p>
          </div>
          <div class="highlight-box">
            <p class="font-bold text-center text-lg">ì–´ë ¤ìš°ì‹ ê°€ìš”? ê±±ì • ë§ˆì„¸ìš”!</p>
            <p class="text-center mt-2 text-gray-700">ì¶œêµ­ ë‹¹ì¼ ê³µí•­ì—ì„œ <strong>ì•ˆìƒí˜„</strong>ì´ ì„¤ì¹˜/ë“±ë¡ ë„ì™€ë“œë¦½ë‹ˆë‹¤.</p>
          </div>
        </div>
        <div class="info-section">
          <h4 class="info-title"><i class="fas fa-shield-alt mr-2"></i>ì•ˆì „ ë° ê¸°íƒ€ ìœ ì˜ì‚¬í•­</h4>
          <ul class="list-disc list-inside ml-4 mt-2 space-y-2 text-gray-700">
            <li><strong>ì†Œì§€í’ˆ ê´€ë¦¬:</strong> ì‚¬ëŒì´ ë§ì€ ê³³ì—ì„œ ì†Œë§¤ì¹˜ê¸° ì£¼ì˜. ì—¬ê¶ŒÂ·í˜„ê¸ˆ ì•ˆì „ ë³´ê´€.</li>
            <li><strong>ë¹„ìƒì‹œ ëŒ€ì²˜:</strong> ê°€ì´ë“œ/ìˆ™ì†Œ ì—°ë½ì²˜ ì†Œì§€, ì—¬ê¶Œ ì‚¬ë³¸(ì‚¬ì§„) íœ´ëŒ€ì „í™” ì €ì¥.</li>
            <li><strong>ë‹¨ì²´ í–‰ë™:</strong> ê°€ì´ë“œ ì•ˆë‚´ì— ë”°ë¼ í•¨ê»˜ ì´ë™. ëŒë°œ ë‹¨ë… í–‰ë™ ìì œ.</li>
          </ul>
        </div>
      </div>`;

    // Section: Checklist
    let clHTML = `
      <div class="accordion-header flex justify-between items-center p-5">
        <h2 class="text-xl font-semibold text-blue-700">
          <i class="fas fa-list-check mr-3"></i>ì¤€ë¹„ë¬¼ ì²´í¬ë¦¬ìŠ¤íŠ¸
        </h2>
        <div class="flex items-center space-x-2">
          <label for="check-checklist" class="text-sm font-medium text-gray-600">ëª¨ë‘ í™•ì¸</label>
          <input type="checkbox" id="check-checklist" data-section="checklist" class="h-5 w-5 rounded border-gray-300 text-blue-600">
        </div>
        <i class="fas fa-chevron-down icon ml-4"></i>
      </div>
      <div class="accordion-content p-5 border-t border-gray-200 grid grid-cols-1 md:grid-cols-2 gap-6">`;
    const cats = {docs:'ì„œë¥˜/ê¸ˆìœµ',clothing:'ì˜ë¥˜/ìƒí™œ',electronics:'ì „ìê¸°ê¸°',medicine:'ìƒë¹„ì•½/ê¸°íƒ€'};
    for (const cat in checklistItems){
      clHTML += `<div><h4 class="font-bold mb-2">${cats[cat]}</h4><ul class="space-y-2">`;
      checklistItems[cat].forEach(item=>{
        clHTML += `<li><input type="checkbox" id="${item.id}" data-section="checklist" data-item="${item.id}" class="h-4 w-4 rounded border-gray-300 text-blue-600"><label for="${item.id}" class="ml-2">${item.text}</label></li>`;
      });
      clHTML += `</ul></div>`;
    }
    clHTML += `</div>`;
    document.getElementById('section-checklist').innerHTML = clHTML;

    // Section: Schedule
    document.getElementById('section-schedule').innerHTML = `
      <div class="accordion-header flex justify-between items-center p-5">
        <h2 class="text-xl font-semibold text-blue-700">
          <i class="fas fa-calendar-alt mr-3"></i>3ë°• 4ì¼ ì„¸ë¶€ ì¼ì •í‘œ
        </h2>
        <div class="flex items-center space-x-2">
          <label for="check-schedule" class="text-sm font-medium text-gray-600">í™•ì¸ì™„ë£Œ</label>
          <input type="checkbox" id="check-schedule" data-section="schedule" class="h-5 w-5 rounded border-gray-300 text-blue-600">
        </div>
        <i class="fas fa-chevron-down icon ml-4"></i>
      </div>
      <div class="accordion-content p-5 border-t border-gray-200">
        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead class="bg-blue-50">
              <tr>
                <th class="p-3 font-semibold text-sm">ì¼ì</th>
                <th class="p-3 font-semibold text-sm">ì£¼ìš” í™œë™</th>
                <th class="p-3 font-semibold text-sm">ì‹ì‚¬</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b">
                <td class="p-3 font-medium">1ì¼ì°¨ (7/26, í† )</td>
                <td class="p-3">ì¸ì²œê³µí•­ ì§‘ê²°(09:20) ë° ì¶œêµ­, ë‚¨ê²½ ë„ì°©. êµë¶€ì˜, ë¶€ìë¬˜ ì˜›ê±°ë¦¬ ê´€ê´‘.</td>
                <td class="p-3">ì„: í˜„ì§€ì‹</td>
              </tr>
              <tr class="border-b">
                <td class="p-3 font-medium">2ì¼ì°¨ (7/27, ì¼)</td>
                <td class="p-3">ë‚¨ê²½ëŒ€í•™ì‚´ê¸°ë…ê´€, ìœ„ì•ˆë¶€ ë°•ë¬¼ê´€, ì¤‘ì‚°ë¦‰, ëª…íš¨ë¦‰ ê´€ê´‘ í›„ ì „ì‹  ë§ˆì‚¬ì§€ ì²´í—˜.</td>
                <td class="p-3">ì¡°: í˜¸í…”, ì¤‘: í˜„ì§€, ì„: í˜„ì§€</td>
              </tr>
              <tr class="border-b">
                <td class="p-3 font-medium">3ì¼ì°¨ (7/28, ì›”)</td>
                <td class="p-3">ìš°ìˆ˜ì‚°, ë”ì§€í”Œë¼ì, ë…ë¦½êµ° ë³¸ë¶€ í„°, í˜„ë¬´ê³µì›(ë±ƒë†€ì´) ê´€ê´‘.</td>
                <td class="p-3">ì¡°: í˜¸í…”, ì¤‘: í˜„ì§€, ì„: í˜„ì§€</td>
              </tr>
              <tr>
                <td class="p-3 font-medium">4ì¼ì°¨ (7/29, í™”)</td>
                <td class="p-3">ë‚¨ê²½ ì¤‘í™”ë¬¸ ê´€ê´‘ í›„ ê³µí•­ìœ¼ë¡œ ì´ë™, ì¸ì²œ ë„ì°©.</td>
                <td class="p-3">ì¡°: í˜¸í…”, ì¤‘: í˜„ì§€</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>`;
  }

  /* ===========================================================
     === ì‚¬ìš©ì ìƒíƒœ ì ìš© ======================================
     =========================================================== */
  function applyUserState(user){
    const userData = confirmationData[user] || {};
    // ì„¹ì…˜ ì²´í¬
    Object.keys(sections).forEach(k=>{
      const el = document.getElementById(`check-${k}`);
      if(el) el.checked = !!userData[k];
    });
    // ì¤€ë¹„ë¬¼ ì²´í¬ ì´ˆê¸°í™” í›„ ë°˜ì˜
    document.querySelectorAll('#section-checklist input[type=checkbox][data-item]').forEach(cb=>cb.checked=false);
    if(userData.checklist){
      for(const cat in checklistItems){
        checklistItems[cat].forEach(item=>{
          const cb = document.getElementById(item.id);
          if(cb) cb.checked = !!userData.checklist[item.id];
        });
      }
    }
  }

  /* ===========================================================
     === ì´ë²¤íŠ¸ ë¬¶ê¸° ===========================================
     =========================================================== */
  function setupGlobalEvents(){
    // ì´ë¦„ ì„ íƒ
    nameSelector.addEventListener('click',(e)=>{
      if(e.target.tagName!=='BUTTON') return;
      currentUser = e.target.dataset.name;
      loginScreen.classList.add('hidden');
      mainScreen.classList.remove('hidden');
      renderMainContent(currentUser);
    });

    // ë¡œê·¸ì•„ì›ƒ
    logoutButton.addEventListener('click',()=>{
      currentUser=null;
      mainScreen.classList.add('hidden');
      loginScreen.classList.remove('hidden');
    });

    // ë¡œì»¬ ì´ˆê¸°í™”
    resetButton.addEventListener('click',resetLocal);

    // ì˜¨ë¼ì¸ ê³µìœ  í† ê¸€
    onlineShareToggle.addEventListener('change',()=>{
      shareEnabled = onlineShareToggle.checked;
      if(shareEnabled && currentUser){
        // ì¦‰ì‹œ í˜„ì¬ ìƒíƒœ í‘¸ì‹œ
        Object.keys(sections).forEach(k=>{
          updateOnline(currentUser,k,!!confirmationData[currentUser][k]);
        });
        if(SHARE_CHECK_COUNTS){
          const counts = countChecklist(currentUser);
          updateOnline(currentUser,'checklist',!!confirmationData[currentUser].checklist);
          updateOnline(currentUser,'_dummy',false); // noop forces merge; safe ignore
        }
      }
    });

    // ë©”ì¸ ì»¨í…Œì´ë„ˆ ì²´í¬ ì´ë²¤íŠ¸ ë¸ë¦¬ê²Œì´ì…˜
    mainContentContainer.addEventListener('change',(e)=>{
      if(e.target.tagName!=='INPUT' || e.target.type!=='checkbox') return;
      if(!currentUser) return;
      const section = e.target.dataset.section;
      const itemId  = e.target.dataset.item || null;
      const checked = e.target.checked;
      updateLocalState(currentUser,section,checked,itemId);
      if(section && !itemId){ // ì„¹ì…˜ ack
        updateOnline(currentUser,section,checked);
      }else if(itemId){       // checklist item local only; update count summary if share
        if(shareEnabled) updateOnline(currentUser,'checklist',true); // triggers count merge
      }
    });
  }

  /* ===========================================================
     === ë¡œì»¬ ìƒíƒœ ê°±ì‹  ========================================
     =========================================================== */
  function updateLocalState(user,section,checked,itemId=null){
    if(!confirmationData[user]) confirmationData[user]={checklist:{}};
    if(itemId){
      // ê°œë³„ ì¤€ë¹„ë¬¼
      confirmationData[user].checklist[itemId]=checked;
      // check-checklist (ëª¨ë‘ í™•ì¸) ìë™ ì—…ë°ì´íŠ¸
      const allDone = allChecklistDone(user);
      const secBox = document.getElementById('check-checklist');
      if(secBox) secBox.checked = allDone;
      // ì„¹ì…˜ ìƒíƒœë„ ë™ê¸°í™”
      confirmationData[user].checklist_all = allDone;
    }else{
      // ì„¹ì…˜ ack
      confirmationData[user][section]=checked;
      if(section==='checklist'){
        // ì‚¬ìš©ìê°€ 'ëª¨ë‘ í™•ì¸'ì„ ëˆŒë €ë‹¤ë©´ ì „ì²´ ì²´í¬
        setAllChecklist(user,checked);
      }
    }
    saveLocalData();
  }

  function allChecklistDone(user){
    const cl = confirmationData[user]?.checklist || {};
    for(const cat in checklistItems){
      for(const item of checklistItems[cat]){
        if(!cl[item.id]) return false;
      }
    }
    return true;
  }
  function setAllChecklist(user,value){
    for(const cat in checklistItems){
      for(const item of checklistItems[cat]){
        confirmationData[user].checklist[item.id]=value;
        const cb = document.getElementById(item.id);
        if(cb) cb.checked = value;
      }
    }
  }

  /* ===========================================================
     === ì•„ì½”ë””ì–¸ ==============================================
     =========================================================== */
  function setupAccordion(){
    const items = document.querySelectorAll('.accordion-item');
    items.forEach(item=>{
      const header = item.querySelector('.accordion-header');
      const content = item.querySelector('.accordion-content');
      if(!header||!content) return;
      header.addEventListener('click',(e)=>{
        // avoid clicking internal checkbox to toggle accordion
        if(e.target.tagName==='INPUT' || e.target.tagName==='LABEL') return;
        const isActive = header.classList.toggle('active');
        content.style.display = isActive ? 'block' : 'none';
      });
    });
    // ì²« ì„¹ì…˜ ìë™ í¼ì¹¨
    const firstHeader = items[0]?.querySelector('.accordion-header');
    const firstContent= items[0]?.querySelector('.accordion-content');
    if(firstHeader && firstContent){
      firstHeader.classList.add('active');
      firstContent.style.display='block';
    }
  }

  /* ===========================================================
     === D-Day ìœ„ì ¯ ============================================
     =========================================================== */
  function renderDDay(){
    const target = new Date('2025-07-26T00:00:00+09:00'); // ì¶œêµ­ì¼
    const today  = new Date();
    const d = Math.ceil((target.setHours(0,0,0,0)-today.setHours(0,0,0,0))/86400000);
    const el = document.getElementById('dday-widget');
    if(!el) return;
    if(d>0) el.textContent = `D-${d} (ì¶œêµ­ê¹Œì§€ ${d}ì¼)`;
    else if(d===0) el.textContent = 'ì˜¤ëŠ˜ ì¶œêµ­! (D-Day)';
    else el.textContent = `D+${Math.abs(d)}`;
  }

  /* ===========================================================
     === ì¶œêµ­ ë‹¹ì¼ ëª¨ë“œ ========================================
     - ìë™: ì‹œìŠ¤í…œ ë‚ ì§œê°€ 2025-07-26ì¼
     - ìˆ˜ë™: URL ?mode=day0
     =========================================================== */
  function applyDay0Mode(){
    const urlFlag = new URL(location.href).searchParams.get('mode')==='day0';
    const today = new Date();
    const isDay0Date = (today.getFullYear()===2025 && today.getMonth()===6 && today.getDate()===26);
    if(!urlFlag && !isDay0Date) return;

    // ìˆ¨ê¸¸ ì„¹ì…˜
    ['section-info','section-checklist','section-schedule'].forEach(id=>{
      document.getElementById(id)?.classList.add('hidden-important');
    });

    // ë°°ë„ˆ í‘œì‹œ
    const root = document.getElementById('app-root');
    const banner = document.createElement('div');
    banner.className = 'mb-4 p-3 rounded-md bg-blue-600 text-white text-center';
    banner.textContent = 'ì¶œêµ­ ë‹¹ì¼ ëª¨ë“œ: ê°€ì¥ ì¤‘ìš”í•œ ì§‘ê²° ì •ë³´ë§Œ í‘œì‹œ ì¤‘';
    root.insertBefore(banner, root.firstChild);
  }

  /* ===========================================================
     === ë©”ì¸ ì§„ì… =============================================
     =========================================================== */
  async function main(){
    loadLocalData();      // ë¡œì»¬
    renderLoginScreen();  // ì´ë¦„ ë²„íŠ¼ ì„¸íŒ…
    setupGlobalEvents();  // ì´ë²¤íŠ¸
    renderDDay();         // ìœ„ì ¯

    await firebaseInitAuth(); // Firebase ì¤€ë¹„
    subscribeOnlineData();    // ì˜¨ë¼ì¸ êµ¬ë…
  }

  document.addEventListener('DOMContentLoaded', main);
</script>
</body>
</html>
